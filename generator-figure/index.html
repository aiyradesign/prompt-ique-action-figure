<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Prompt Generator – Action Figure | prompt.ique</title>
    <meta name="description" content="Buat prompt AI untuk desain action figure dengan gaya visual 4D Hyper Realism atau 3D Chibi melalui Promptique.">
    
    <meta property="og:title" content="Promptique | AI Prompt Generator Action Figure">
    <meta property="og:description" content="Buat prompt AI untuk desain action figure keren. Siap digunakan di ChatGPT, Midjourney, dan AI Studio.">
    <meta property="og:image" content="https://promptique.my.id/karakter_1.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:url" content="https://promptique.my.id/">
    <meta property="og:type" content="website">

    <link rel="icon" href="../icon.png" type="image/png" />
    
    <!-- Tailwind CSS & Font Awesome -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* slate-900 */
            color: #cbd5e1; /* slate-300 */
        }
        .gradient-text {
            background: linear-gradient(to right, #5eead4, #a78bfa, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #94a3b8; /* slate-400 */
        }
        .form-input, .form-textarea, .form-select {
            width: 100%;
            background-color: #1e293b; /* slate-800 */
            border: 1px solid #334155; /* slate-700 */
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            color: #f1f5f9; /* slate-100 */
            transition: all 0.2s;
        }
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            border-color: #a78bfa; /* violet-400 */
            box-shadow: 0 0 0 2px rgba(167, 139, 250, 0.3);
            outline: none;
        }
        .form-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2394a3b8' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.2);
            width: 20px; height: 20px;
            border-radius: 50%; border-left-color: white;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Custom Alert System Styles */
        .custom-alert-overlay {
            position: fixed; inset: 0; background-color: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(5px); display: flex; align-items: center; justify-content: center;
            padding: 1rem; z-index: 110; opacity: 0; transition: opacity 0.3s ease; pointer-events: none;
        }
        .custom-alert-overlay.show { opacity: 1; pointer-events: auto; }
        .custom-alert-box {
            background-color: #1e293b; border: 1px solid #334155; border-radius: 0.75rem;
            width: 100%; max-width: 400px; padding: 2rem; text-align: center;
            transform: scale(0.95); transition: transform 0.3s ease;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        .custom-alert-overlay.show .custom-alert-box { transform: scale(1); }
        .custom-alert-icon {
            width: 4rem; height: 4rem; border-radius: 50%;
            display: inline-flex; align-items: center; justify-content: center;
            margin-bottom: 1rem; font-size: 2rem;
        }
        .custom-alert-icon.success { background-color: rgba(45, 212, 191, 0.1); color: #5eead4; }
        .custom-alert-icon.error { background-color: rgba(244, 63, 94, 0.1); color: #fb7185; }

        .modal-overlay {
            position: fixed; inset: 0; background-color: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center;
            padding: 1rem; z-index: 110; opacity: 0; transition: opacity 0.3s ease; pointer-events: none;
        }
        .modal-overlay.show { opacity: 1; pointer-events: auto; }
        .modal-content {
            background-color: #1e293b; border: 1px solid #334155; border-radius: 0.75rem;
            width: 100%; max-width: 600px;
            transform: scale(0.95); transition: transform 0.3s ease;
        }
        .modal-overlay.show .modal-content { transform: scale(1); }
        
        fieldset:disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        body.light-theme {
            background-color: #f1f5f9; /* slate-100 */
            color: #1e293b; /* slate-800 */
        }
        body.light-theme .form-input, body.light-theme .form-textarea, body.light-theme .form-select {
            background-color: #ffffff;
            border-color: #cbd5e1; /* slate-300 */
            color: #1e293b;
        }
        body.light-theme .form-input:focus, body.light-theme .form-textarea:focus, body.light-theme .form-select:focus {
            border-color: #8b5cf6;
        }
        body.light-theme .form-label { color: #475569; /* slate-600 */ }
        body.light-theme .bg-slate-800\/50 { background-color: rgba(255,255,255,0.7); }
        body.light-theme .border-slate-700 { border-color: #e2e8f0; /* slate-200 */ }
        body.light-theme .text-slate-400 { color: #64748b; /* slate-500 */ }
        body.light-theme .modal-content, body.light-theme .custom-alert-box { background-color: #f8fafc; border-color: #e2e8f0; }
        body.light-theme .modal-overlay, body.light-theme .custom-alert-overlay { background-color: rgba(226, 232, 240, 0.8); }
        body.light-theme .floating-btn { background-color: white; color: #1e293b; }
    </style>
</head>
<body class="antialiased">

    <!-- Floating Buttons -->
    <div class="fixed top-4 right-4 z-50 flex flex-col gap-3">
        <button id="theme-toggle" class="floating-btn h-12 w-12 flex items-center justify-center rounded-full bg-slate-700/50 text-slate-300 hover:bg-slate-600/70 transition-colors backdrop-blur-sm border border-slate-600 shadow-lg" title="Ganti Tema">
            <i class="fas fa-sun"></i>
        </button>
        <button id="history-btn" class="floating-btn h-12 w-12 flex items-center justify-center rounded-full bg-slate-700/50 text-slate-300 hover:bg-slate-600/70 transition-colors backdrop-blur-sm border border-slate-600 shadow-lg" title="Riwayat Cerita">
            <i class="fas fa-history"></i>
        </button>
    </div>

    <div class="container mx-auto max-w-4xl px-4 py-8 sm:py-12">

        <header class="text-center mb-10">
            <h1 class="text-4xl sm:text-5xl font-extrabold tracking-tight gradient-text">
                ACTION FIGURE PROMPT GENERATOR
            </h1>
            <p class="mt-3 text-lg text-slate-400">
                By Aiyra Design | prompt.ique
            </p>
        </header>
        
        <!-- Auth Section -->
        <section id="password-section" class="bg-slate-800/50 border border-slate-700 rounded-xl p-6 sm:p-8 mb-8">
            <h3 class="text-xl font-bold text-center gradient-text mb-4">Akses Terbatas</h3>
            <div class="max-w-sm mx-auto">
                <label for="appPasswordInput" class="form-label">Kata Sandi</label>
                <div class="flex flex-col sm:flex-row gap-2 mb-3">
                    <div class="relative flex-grow">
                        <input type="password" id="appPasswordInput" class="form-input w-full pr-10 text-center sm:text-left" placeholder="Masukkan sandi...">
                        <button type="button" id="togglePasswordBtn" class="absolute inset-y-0 right-0 px-3 flex items-center text-slate-400 hover:text-slate-200" aria-label="Toggle password visibility">
                            <i class="fas fa-eye" id="password-eye-icon"></i>
                        </button>
                    </div>
                    <button id="unlockBtn" class="w-full sm:w-auto bg-violet-600 hover:bg-violet-500 text-white font-bold py-2 px-6 rounded-lg transition-colors flex-shrink-0">Masuk</button>
                </div>
                 <a id="getPassBtn" href="https://lynk.id/aiyradesign/e39qnxl23nl3" target="_blank" class="block w-full bg-teal-600 hover:bg-teal-500 text-white font-bold py-2 px-6 rounded-lg transition-colors text-center">
                    <i class="fas fa-shopping-cart mr-2"></i>Dapatkan Sandi GRATIS
                </a>
            </div>
        </section>

        <!-- Main Generator Fieldset -->
        <fieldset id="generator-fieldset" disabled>
            <div id="logout-section" class="hidden mb-6">
                <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-4 flex flex-col sm:flex-row justify-between items-center gap-3">
                    <p class="text-lg font-semibold text-teal-400">Akses Diberikan!</p>
                    <button id="logout-btn-form" class="w-full sm:w-auto px-4 py-2 bg-red-600 hover:bg-red-500 text-white font-semibold rounded-lg flex items-center justify-center flex-shrink-0"><i class="fas fa-sign-out-alt mr-2"></i>Kunci Ulang</button>
                </div>
            </div>

            <section class="bg-slate-800/50 border border-slate-700 rounded-xl p-6 sm:p-8 mb-8">
                <h3 class="text-xl font-bold text-slate-200 mb-6 text-center gradient-text">
                    <i class="fas fa-magic-wand-sparkles mr-2"></i> AI Assistant
                </h3>
                
                <div class="mb-6 pb-6 border-b border-slate-700">
                    <label for="api-key-input" class="form-label"><i class="fas fa-key w-5 mr-1"></i>API Key Google AI</label>
                    
                    <div class="flex flex-wrap gap-2 mb-3">
                        <button id="guide-btn" class="flex-grow sm:flex-grow-0 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white font-semibold rounded-lg flex items-center justify-center flex-shrink-0"><i class="fas fa-book mr-2"></i>Panduan</button>
                        <a href="https://aistudio.google.com/" target="_blank" rel="noopener noreferrer" class="flex-grow sm:flex-grow-0 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white font-semibold rounded-lg flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-external-link-alt mr-2"></i>Dapatkan Key
                        </a>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row gap-2">
                        <input type="password" id="api-key-input" class="form-input flex-grow" placeholder="Masukkan API Key Anda...">
                        <div class="flex gap-2 w-full sm:w-auto flex-shrink-0">
                            <button type="button" id="save-api-key" class="flex-1 sm:w-auto justify-center px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white font-semibold rounded-lg flex items-center"><i class="fas fa-save mr-2"></i>Simpan</button>
                            <button type="button" id="delete-api-key" class="flex-1 sm:w-auto justify-center px-4 py-2 bg-red-700 hover:bg-red-600 text-white font-semibold rounded-lg flex items-center"><i class="fas fa-trash-alt mr-2"></i>Hapus</button>
                        </div>
                    </div>
                    <p id="api-key-status" class="text-xs mt-2 text-slate-500">Status: Belum diatur.</p>
                </div>
                
                <!-- AI Story Input -->
                <div>
                    <div class="flex flex-col space-y-6 mb-4">
                        <div>
                            <label for="ceritaKarakter" class="form-label"><i class="fas fa-feather-alt w-5 mr-1"></i>Ceritakan singkat tentang karakter Anda</label>
                            <textarea id="ceritaKarakter" rows="4" class="form-textarea" placeholder="Contoh: Seorang prajurit wanita bernama Aiyra dengan rambut perak dan armor kegelapan..."></textarea>
                        </div>
                        <div>
                            <label for="nuansaTemaAi" class="form-label"><i class="fas fa-palette w-5 mr-1"></i>Pilih Nuansa Tema</label>
                            <select id="nuansaTemaAi" class="form-select">
                                <option value="KlasikStudio" selected>Klasik Studio</option>
                                <option value="Cyberpunk">Cyberpunk</option>
                                <option value="FantasiMistis">Fantasi Mistis</option>
                                <option value="PascaApokaliptik">Pasca-Apokaliptik</option>
                                <option value="Steampunk">Steampunk</option>
                                <option value="Kosmik">Kosmik Fiksi Ilmiah</option>
                                <option value="HororGotik">Horor Gotik</option>
                                <option value="BioLuminescent">Hutan Bio-Luminescent</option>
                                <option value="MesirKuno">Mesir Kuno Mistis</option>
                                <option value="KerajaanLangit">Kerajaan di Atas Awan</option>
                                <option value="PasirPantaiTropis">Pasir Pantai Tropis</option>
                                <option value="InteriorDojoJepang">Interior Dojo Jepang</option>
                                <option value="LaboratoriumSciFi">Laboratorium Sci-Fi</option>
                                <option value="DekKapalBajakLaut">Dek Kapal Bajak Laut</option>
                                <option value="TamanBungaSakura">Taman Bunga Sakura</option>
                                <option value="ReruntuhanHutanKuno">Reruntuhan Hutan Kuno</option>
                                <option value="KotaBawahAir">Kota Bawah Air</option>
                                <option value="ArenaGladiator">Arena Gladiator</option>
                                <option value="IstanaEsArktik">Istana Es Arktik</option>
                                <option value="DuniaPermen">Dunia Permen</option>
                            </select>
                        </div>
                    </div>
                    <button id="aiBtn" class="w-full sm:w-auto inline-flex items-center justify-center px-8 py-3 font-bold text-white rounded-full transition-all duration-300 bg-gradient-to-r from-teal-500 via-purple-500 to-pink-500 hover:from-teal-600 hover:via-purple-600 hover:to-pink-600 hover:shadow-lg hover:shadow-purple-500/20">
                        <span id="aiBtnText"><i class="fas fa-lightbulb mr-3"></i>Sesuaikan dengan AI</span>
                        <div class="loading-spinner ml-3 hidden"></div>
                    </button>
                </div>
            </section>

            <section class="bg-slate-800/50 border border-slate-700 rounded-xl p-6 sm:p-8">
                <h3 class="text-xl font-bold text-slate-200 mb-6 text-center gradient-text">
                    <i class="fas fa-pencil-alt mr-2"></i> Detail Manual
                </h3>
                <form id="promptForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div><label for="namaKarakter" class="form-label">Nama Karakter</label><input type="text" id="namaKarakter" class="form-input" placeholder="Contoh: Tomi"></div>
                        <div><label for="gender" class="form-label">Gender</label><select id="gender" class="form-select"><option value="" selected>Pilih...</option><option value="Pria">Pria</option><option value="Wanita">Wanita</option><option value="Non-biner">Non-biner</option></select></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div><label for="deskripsiKarakter" class="form-label">Deskripsi Karakter</label><textarea id="deskripsiKarakter" rows="3" class="form-textarea" placeholder="Rambut perak, mata bersinar..."></textarea></div>
                        <div><label for="deskripsiKostum" class="form-label">Deskripsi Kostum</label><textarea id="deskripsiKostum" rows="3" class="form-textarea" placeholder="Armor kulit hitam dengan rune..."></textarea></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div><label for="senjataAtauBenda" class="form-label">Senjata / Benda</label><textarea id="senjataAtauBenda" rows="3" class="form-textarea" placeholder="Pedang besar atau memegang buku kuno..."></textarea></div>
                        <div><label for="deskripsiPose" class="form-label">Pose dan Ekspresi</label><textarea id="deskripsiPose" rows="3" class="form-textarea" placeholder="Siap tempur, ekspresi fokus..."></textarea></div>
                    </div>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div><label for="astralMagis" class="form-label">Hewan/Makhluk</label><textarea id="astralMagis" rows="3" class="form-textarea" placeholder="Contoh: Naga es transparan..."></textarea></div>
                        <div><label for="lingkungan" class="form-label">Detail Spesifik Alas</label><textarea id="lingkungan" rows="3" class="form-textarea" placeholder="Contoh: reruntuhan kastil, jalanan kota..."></textarea></div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div><label for="bentukAlas" class="form-label">Bentuk Alas</label><select id="bentukAlas" class="form-select"><option value="Bulat" selected>Bulat</option><option value="Persegi">Persegi</option></select></div>
                        <div><label for="gayaVisual" class="form-label">Gaya Visual</label><select id="gayaVisual" class="form-select"><option value="4D Hyper Realism" selected>4D Hyper Realism</option><option value="3D Chibi">3D Chibi</option></select></div>
                    </div>
                    <div><label for="generateBy" class="form-label">Generate By</label><input type="text" id="generateBy" class="form-input" value="PROMPT BY AIYRA DESIGN"></div>
                    
                    <div class="pt-4 flex flex-col sm:flex-row gap-3">
                        <button type="button" id="resetBtn" class="w-full sm:w-auto px-6 py-3 bg-red-600 hover:bg-red-500 text-white font-bold rounded-lg transition-colors"><i class="fas fa-rotate-left mr-2"></i>Reset</button>
                        <button type="button" id="generateBtn" class="w-full sm:flex-grow bg-violet-600 hover:bg-violet-500 text-white font-bold py-3 px-8 rounded-lg transition-colors"><i class="fas fa-cogs mr-2"></i>Hasilkan Prompt</button>
                    </div>
                </form>
                
                <div id="result-section" class="mt-10 pt-6 border-t border-slate-700" style="display: none;">
                    <h3 class="text-lg font-semibold mb-2 text-slate-300">Prompt Final:</h3>
                    <div class="relative">
                        <textarea id="outputPrompt" rows="12" class="form-textarea font-mono text-sm" readonly></textarea>
                        <button id="copyBtn" class="absolute top-3 right-3 bg-slate-600 hover:bg-slate-500 text-white font-semibold py-2 px-3 rounded-lg text-sm flex items-center justify-center">
                            <i class="fas fa-copy mr-2"></i><span id="copy-text">Salin</span>
                        </button>
                    </div>
                </div>
            </section>
        </fieldset>
    </div>
    
    <!-- Modals -->
    <div id="guideModal" class="modal-overlay">
        <div class="modal-content p-6 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6 sticky top-0 bg-slate-800/80 backdrop-blur-sm -m-6 p-6 z-10">
                <h2 class="text-xl font-bold text-white"><i class="fas fa-book-open mr-2"></i>Panduan Mendapatkan API Key</h2>
                <button class="close-modal-btn text-slate-400 hover:text-white text-2xl">&times;</button>
            </div>
            
            <!-- Desktop Guide -->
            <div id="desktop-guide" class="hidden md:block text-slate-300 space-y-6">
                <div class="flex items-start gap-4">
                    <div class="text-teal-400 text-2xl w-8 text-center pt-1"><i class="fas fa-desktop"></i></div>
                    <div>
                        <h3 class="font-bold text-lg text-white">Langkah 1: Buka AI Studio & Dapatkan Kunci</h3>
                        <p class="text-slate-400">Di komputer Anda, buka <a href="https://aistudio.google.com/" target="_blank" class="text-teal-300 hover:underline font-semibold">Google AI Studio</a>. Pada menu di sebelah kiri, klik <strong class="text-white">"Get API key"</strong>.</p>
                    </div>
                </div>
                <div class="flex items-start gap-4">
                    <div class="text-teal-400 text-2xl w-8 text-center pt-1"><i class="fas fa-plus-square"></i></div>
                    <div>
                        <h3 class="font-bold text-lg text-white">Langkah 2: Buat Kunci di Proyek Baru</h3>
                        <p class="text-slate-400">Anda akan diarahkan ke halaman Google AI for Developers. Klik tombol <strong class="text-white">"Create API key in new project"</strong>.</p>
                    </div>
                </div>
                 <div class="flex items-start gap-4">
                    <div class="text-teal-400 text-2xl w-8 text-center pt-1"><i class="fas fa-copy"></i></div>
                    <div>
                        <h3 class="font-bold text-lg text-white">Langkah 3: Salin Kunci Anda</h3>
                        <p class="text-slate-400">Sebuah jendela akan muncul menampilkan Kunci API baru Anda. Klik ikon salin di sebelahnya untuk menyimpannya ke clipboard.</p>
                    </div>
                </div>
                 <div class="flex items-start gap-4">
                    <div class="text-teal-400 text-2xl w-8 text-center pt-1"><i class="fas fa-paste"></i></div>
                    <div>
                        <h3 class="font-bold text-lg text-white">Langkah 4: Tempel & Simpan di Aplikasi</h3>
                        <p class="text-slate-400">Kembali ke aplikasi ini, tempelkan kunci yang sudah disalin ke dalam kolom yang tersedia dan klik tombol <strong class="text-white">"Simpan"</strong>.</p>
                    </div>
                </div>
            </div>

            <!-- Mobile Guide -->
            <div id="mobile-guide" class="block md:hidden text-slate-300 space-y-6">
                 <div class="flex items-start gap-4">
                    <div class="text-teal-400 text-2xl w-8 text-center pt-1"><i class="fas fa-mobile-alt"></i></div>
                    <div>
                        <h3 class="font-bold text-lg text-white">Langkah 1: Buka Menu</h3>
                        <p class="text-slate-400">Di ponsel Anda, buka <a href="https://aistudio.google.com/" target="_blank" class="text-teal-300 hover:underline font-semibold">Google AI Studio</a>. Ketuk ikon menu <i class="fas fa-bars"></i> di pojok kiri atas.</p>
                    </div>
                </div>
                <div class="flex items-start gap-4">
                    <div class="text-teal-400 text-2xl w-8 text-center pt-1"><i class="fas fa-key"></i></div>
                    <div>
                        <h3 class="font-bold text-lg text-white">Langkah 2: Pilih "Get API key"</h3>
                        <p class="text-slate-400">Dari menu yang muncul, ketuk pada pilihan <strong class="text-white">"Get API key"</strong>.</p>
                    </div>
                </div>
                 <div class="flex items-start gap-4">
                    <div class="text-teal-400 text-2xl w-8 text-center pt-1"><i class="fas fa-plus-square"></i></div>
                    <div>
                        <h3 class="font-bold text-lg text-white">Langkah 3: Buat Kunci Baru</h3>
                        <p class="text-slate-400">Di halaman berikutnya, ketuk tombol <strong class="text-white">"Create API key in new project"</strong>.</p>
                    </div>
                </div>
                 <div class="flex items-start gap-4">
                    <div class="text-teal-400 text-2xl w-8 text-center pt-1"><i class="fas fa-copy"></i></div>
                    <div>
                        <h3 class="font-bold text-lg text-white">Langkah 4: Salin Kunci Anda</h3>
                        <p class="text-slate-400">Kunci API baru Anda akan ditampilkan. Ketuk ikon salin di sebelahnya.</p>
                    </div>
                </div>
                <div class="flex items-start gap-4">
                    <div class="text-teal-400 text-2xl w-8 text-center pt-1"><i class="fas fa-paste"></i></div>
                    <div>
                        <h3 class="font-bold text-lg text-white">Langkah 5: Tempel & Simpan</h3>
                        <p class="text-slate-400">Kembali ke aplikasi ini, tempelkan kunci Anda di kolom yang tersedia dan klik tombol <strong class="text-white">"Simpan"</strong>.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="licenseModal" class="modal-overlay"><div class="modal-content p-6"><div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold text-white"><i class="fas fa-file-contract mr-2"></i>Lisensi</h2><button class="close-modal-btn text-slate-400 hover:text-white text-2xl">&times;</button></div><div class="text-slate-300 space-y-3 max-h-[70vh] overflow-y-auto pr-2"> <h3 style="color: #4ade80;">✅ Anda Diperbolehkan:</h3> <ul> <li>Mengakses dan menggunakan generator untuk keperluan pribadi.</li> <li>Memposting hasil gambar ke media sosial atau portofolio pribadi (bukan untuk jualan).</li> <li>Menggunakan hasil prompt di platform AI seperti ChatGPT, Midjourney, dll.</li> <li>Menyimpan hasil untuk koleksi atau referensi pribadi.</li> </ul> <h3 style="color: #f87171;">❌ Anda Tidak Diperbolehkan:</h3> <ul> <li>Menjual atau mendistribusikan ulang isi maupun hasil generator.</li> <li>Menggunakan konten untuk proyek klien atau tujuan komersial.</li> <li>Mengklaim sebagai pencipta sistem atau konten.</li> <li>Mengunggah ulang isi sistem ke platform lain.</li> </ul> <p><strong>Catatan Penting:</strong> Lisensi ini bersifat pribadi, non-komersial, dan terbatas. Penggunaan publik diperbolehkan selama tidak digunakan untuk tujuan komersial.</p> <p style="text-align: right; font-style: italic;">Dikeluarkan oleh: AIYRA DESIGN | Kardiansyah</p></div></div></div>
    <div id="logoutConfirmModal" class="modal-overlay"><div class="modal-content p-6"><h2 class="text-xl font-bold text-white mb-4">Konfirmasi Keluar</h2><p class="text-slate-300 mb-6">Apakah Anda yakin ingin keluar dan mengunci ulang aplikasi?</p><div class="flex justify-end gap-3"><button class="close-modal-btn px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white font-semibold rounded-lg">Batal</button><button id="confirmLogoutBtn" class="px-4 py-2 bg-red-600 hover:bg-red-500 text-white font-semibold rounded-lg">Ya, Keluar</button></div></div></div>
    <div id="historyModal" class="modal-overlay"><div class="modal-content p-6"><div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold text-white"><i class="fas fa-history mr-2"></i>Riwayat Cerita</h2><button class="close-modal-btn text-slate-400 hover:text-white text-2xl">&times;</button></div><div id="history-list" class="text-slate-300 space-y-2 max-h-[60vh] overflow-y-auto"></div><div class="mt-6 flex justify-end gap-3"><button id="clear-history-btn" class="px-4 py-2 bg-red-600 hover:bg-red-500 text-white font-semibold rounded-lg">Bersihkan Riwayat</button><button class="close-modal-btn px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white font-semibold rounded-lg">Tutup</button></div></div></div>

    <!-- Custom Alert Container -->
    <div id="custom-alert-overlay" class="custom-alert-overlay">
        <div class="custom-alert-box">
            <div id="custom-alert-icon" class="custom-alert-icon"></div>
            <h4 id="custom-alert-title" class="font-bold text-lg mb-1 text-white"></h4>
            <p id="custom-alert-message" class="text-sm text-slate-300"></p>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DevTools Protection ---
        const devToolsProtection = () => {
            const threshold = 160;
            let start = new Date();
            debugger;
            let end = new Date();
            if (end - start > threshold) {
                // DevTools is open
                document.body.innerHTML = '<div style="position:fixed; top:0; left:0; width:100%; height:100%; background: #0f172a; color:white; display:flex; justify-content:center; align-items:center; font-family: sans-serif; font-size: 2rem;">Akses tidak diizinkan.</div>';
                setTimeout(() => {
                    window.location.href = 'about:blank';
                }, 1000);
            }
        };
        setInterval(devToolsProtection, 1000);

        // --- Get All DOM Elements ---
        const passwordSection = document.getElementById('password-section');
        const generatorFieldset = document.getElementById('generator-fieldset');
        const unlockBtn = document.getElementById('unlockBtn');
        const appPasswordInput = document.getElementById('appPasswordInput');
        const logoutSection = document.getElementById('logout-section');
        const logoutBtnForm = document.getElementById('logout-btn-form');
        const confirmLogoutBtn = document.getElementById('confirmLogoutBtn');
        const resultSection = document.getElementById('result-section');
        const outputPromptEl = document.getElementById('outputPrompt');
        const aiBtn = document.getElementById('aiBtn');
        const generateBtn = document.getElementById('generateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const copyBtn = document.getElementById('copyBtn');
        const togglePasswordBtn = document.getElementById('togglePasswordBtn');
        const passwordEyeIcon = document.getElementById('password-eye-icon');
        
        // Alert elements
        const alertOverlay = document.getElementById('custom-alert-overlay');
        const alertIcon = document.getElementById('custom-alert-icon');
        const alertTitle = document.getElementById('custom-alert-title');
        const alertMessage = document.getElementById('custom-alert-message');

        const saveApiKeyBtn = document.getElementById('save-api-key');
        const deleteApiKeyBtn = document.getElementById('delete-api-key');
        const apiKeyInput = document.getElementById('api-key-input');
        const apiKeyStatus = document.getElementById('api-key-status');
        const promptForm = document.getElementById('promptForm');
        const ceritaKarakterEl = document.getElementById('ceritaKarakter');
        const themeToggleBtn = document.getElementById('theme-toggle');
        const historyBtn = document.getElementById('history-btn');
        const historyList = document.getElementById('history-list');
        const clearHistoryBtn = document.getElementById('clear-history-btn');
        const body = document.body;

        // Modals
        const guideModal = document.getElementById('guideModal');
        const licenseModal = document.getElementById('licenseModal');
        const logoutConfirmModal = document.getElementById('logoutConfirmModal');
        const historyModal = document.getElementById('historyModal');
        const allModals = [guideModal, licenseModal, logoutConfirmModal, historyModal];

        // --- Modal Control ---
        function openModal(modalElement) { modalElement.classList.add('show'); }
        function closeModal(modalElement) { modalElement.classList.remove('show'); }
        
        document.getElementById('guide-btn').addEventListener('click', () => openModal(guideModal));
        logoutBtnForm.addEventListener('click', () => openModal(logoutConfirmModal));
        historyBtn.addEventListener('click', () => {
            loadHistory();
            openModal(historyModal);
        });

        allModals.forEach(modal => {
            if(modal) {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal || e.target.closest('.close-modal-btn')) {
                        closeModal(modal);
                    }
                });
            }
        });

        // --- Custom Alert System ---
        function showAlert(type, title, message) {
            alertIcon.className = 'custom-alert-icon'; // Reset classes
            if (type === 'success') {
                alertIcon.classList.add('success');
                alertIcon.innerHTML = `<i class="fas fa-check"></i>`;
            } else { // error
                alertIcon.classList.add('error');
                alertIcon.innerHTML = `<i class="fas fa-times"></i>`;
            }
            alertTitle.textContent = title;
            alertMessage.textContent = message;
            alertOverlay.classList.add('show');
            setTimeout(() => {
                alertOverlay.classList.remove('show');
            }, 3000);
        }
        alertOverlay.addEventListener('click', () => alertOverlay.classList.remove('show'));

        
        // --- Main App Logic ---
        function grantAccess() {
            passwordSection.style.display = 'none';
            generatorFieldset.disabled = false;
            logoutSection.classList.remove('hidden');
        }
        
        function lockAccess() {
            localStorage.removeItem('unlockTimestamp');
            showAlert('success', 'Akses Terkunci', 'Aplikasi telah berhasil dikunci kembali.');
            setTimeout(() => location.reload(), 1500);
        }

        function checkAccess() {
            const unlockedTime = localStorage.getItem('unlockTimestamp');
            if (unlockedTime) {
                const oneDay = 24 * 60 * 60 * 1000;
                const timeDiff = new Date().getTime() - unlockedTime;
                if (timeDiff < oneDay) {
                    grantAccess();
                    return;
                } else {
                    localStorage.removeItem('unlockTimestamp');
                }
            }
            passwordSection.style.display = 'block';
            generatorFieldset.disabled = true;
            logoutSection.classList.add('hidden');
        }
        
        // --- Gemini API Call ---
        async function fetchAI(apiKey, payload) {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json();
                console.error("API Error:", errorData);
                throw new Error(errorData.error?.message || 'Terjadi kesalahan pada respons dari AI.');
            }
            
            const result = await response.json();

            if (result.candidates && result.candidates.length > 0 && result.candidates[0].content?.parts[0]?.text) {
                 let rawText = result.candidates[0].content.parts[0].text;
                 rawText = rawText.replace(/^```json\s*/, '').replace(/```$/, '');
                 return JSON.parse(rawText);
            } else {
                console.error("Invalid response structure:", result);
                throw new Error('Gagal memproses data dari AI karena format tidak sesuai.');
            }
        }

        // --- Event Listeners ---
        togglePasswordBtn.addEventListener('click', () => {
            const isPassword = appPasswordInput.type === 'password';
            appPasswordInput.type = isPassword ? 'text' : 'password';
            passwordEyeIcon.classList.toggle('fa-eye', !isPassword);
            passwordEyeIcon.classList.toggle('fa-eye-slash', isPassword);
        });

        unlockBtn.addEventListener('click', () => {
            if (appPasswordInput.value === '1') {
                localStorage.setItem('unlockTimestamp', new Date().getTime());
                showAlert('success', 'Akses Diberikan', 'Selamat datang! Anda sekarang dapat menggunakan aplikasi.');
                grantAccess();
            } else {
                showAlert('error', 'Gagal Masuk', 'Kata sandi yang Anda masukkan salah. Silakan coba lagi.');
                appPasswordInput.value = '';
            }
        });
        
        appPasswordInput.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') unlockBtn.click();
        });

        confirmLogoutBtn.addEventListener('click', () => {
            closeModal(logoutConfirmModal);
            lockAccess();
        });

        const updateApiKeyStatus = () => {
            const key = localStorage.getItem('geminiApiKey');
            if (key) {
                apiKeyStatus.textContent = 'Status: Kunci API aktif dan tersimpan.';
                apiKeyStatus.style.color = '#5eead4';
                apiKeyInput.value = key;
            } else {
                apiKeyStatus.textContent = 'Status: Kunci API belum diatur.';
                apiKeyStatus.style.color = '#94a3b8';
                apiKeyInput.value = '';
            }
        };

        saveApiKeyBtn.addEventListener('click', () => {
            const apiKey = apiKeyInput.value.trim();
            if (apiKey) {
                localStorage.setItem('geminiApiKey', apiKey);
                showAlert('success', 'Berhasil', 'Kunci API Anda telah berhasil disimpan.');
                updateApiKeyStatus();
            } else {
                showAlert('error', 'Input Kosong', 'Mohon masukkan Kunci API yang valid pada kolom yang tersedia.');
            }
        });

        deleteApiKeyBtn.addEventListener('click', () => {
            if (localStorage.getItem('geminiApiKey')) {
                localStorage.removeItem('geminiApiKey');
                showAlert('success', 'Berhasil', 'Kunci API Anda telah dihapus.');
                updateApiKeyStatus();
            } else {
                showAlert('error', 'Tidak Ada Kunci', 'Tidak ada Kunci API yang bisa dihapus.');
            }
        });


        aiBtn.addEventListener('click', async () => {
            const apiKey = localStorage.getItem('geminiApiKey') || "";
            const userStory = ceritaKarakterEl.value.trim();
            
            if (!userStory) {
                showAlert('error', 'Cerita Dibutuhkan', 'Mohon isi kolom cerita. AI memerlukan ide awal untuk bisa membantu Anda.');
                return;
            }
            if (!apiKey) {
                showAlert('error', 'Kunci API Diperlukan', 'Harap masukkan dan simpan Kunci API Anda terlebih dahulu untuk menggunakan fitur ini.');
                return;
            }

            const aiBtnText = document.getElementById('aiBtnText');
            const spinner = aiBtn.querySelector('.loading-spinner');
            aiBtnText.textContent = 'Memproses...';
            spinner.classList.remove('hidden');
            aiBtn.disabled = true;

            try {
                const improvedPrompt = `Anda adalah asisten desainer figur aksi AI yang sangat presisi. Tugas utama Anda adalah mengubah cerita singkat dari pengguna menjadi data terstruktur dalam format JSON yang **ketat** dan **valid**. Anda harus berimprovisasi secara kreatif untuk mengisi detail yang hilang.

Berdasarkan cerita pengguna ini: "${userStory}"

Lengkapi **semua** field dalam struktur JSON berikut. Jangan tinggalkan field apa pun.

- **namaKarakter**: (string) Ekstrak nama dari cerita. Jika tidak ada, ciptakan nama yang keren dan sesuai.
- **gender**: (string) Tentukan dari cerita. **Harus** salah satu dari: "Pria", "Wanita", atau "Non-biner".
- **deskripsiKarakter**: (string) Deskripsikan penampilan fisik karakter secara detail (wajah, rambut, mata, ciri khas).
- **deskripsiKostum**: (string) Rancang kostum yang ikonik dan detail. Kembangkan ide pengguna atau buat dari awal jika tidak ada.
- **senjataAtauBenda**: (string) **PENTING**: Jika relevan dengan cerita (misal: pedang untuk ksatria, laptop untuk peretas), deskripsikan. Jika sama sekali tidak relevan (misal: untuk seorang penari), **WAJIB** isi dengan string kosong ("").
- **deskripsiPose**: (string) Ciptakan pose yang dinamis, ekspresif, dan menceritakan karakter.
- **lingkungan**: (string) Deskripsikan diorama miniatur yang ada **di atas alas figur**. Ini harus mencerminkan cerita inti karakter (misal: untuk astronot, 'permukaan bulan dengan kawah kecil'; untuk koki, 'potongan meja dapur dengan talenan').
- **astralMagis**: (string) **PENTING**: Jika ada hewan, makhluk, atau pendamping magis dalam cerita, deskripsikan. Jika tidak ada, **WAJIB** isi dengan string kosong ("").

Pastikan output Anda **HANYA** berupa objek JSON yang valid, sesuai dengan skema yang diberikan, tanpa teks atau pemformatan tambahan.`;

                const generationPayload = {
                    contents: [{ role: "user", parts: [{ text: improvedPrompt }] }],
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "namaKarakter": { "type": "STRING" }, 
                                "gender": { "type": "STRING", "enum": ["Pria", "Wanita", "Non-biner"] }, 
                                "deskripsiKarakter": { "type": "STRING" }, 
                                "deskripsiKostum": { "type": "STRING" }, 
                                "senjataAtauBenda": { "type": "STRING" }, 
                                "deskripsiPose": { "type": "STRING" }, 
                                "lingkungan": { "type": "STRING" }, 
                                "astralMagis": { "type": "STRING" }
                            },
                             "required": ["namaKarakter", "gender", "deskripsiKarakter", "deskripsiKostum", "senjataAtauBenda", "deskripsiPose", "lingkungan", "astralMagis"]
                        }
                    }
                };
                const characterData = await fetchAI(apiKey, generationPayload);

                if (characterData) {
                    document.getElementById('namaKarakter').value = characterData.namaKarakter || '';
                    document.getElementById('gender').value = characterData.gender || '';
                    document.getElementById('deskripsiKarakter').value = characterData.deskripsiKarakter || '';
                    document.getElementById('deskripsiKostum').value = characterData.deskripsiKostum || '';
                    document.getElementById('senjataAtauBenda').value = characterData.senjataAtauBenda || '';
                    document.getElementById('deskripsiPose').value = characterData.deskripsiPose || '';
                    document.getElementById('lingkungan').value = characterData.lingkungan || '';
                    document.getElementById('astralMagis').value = characterData.astralMagis || '';
                    showAlert('success', 'Analisis Selesai', 'AI telah berhasil mengisi detail karakter untuk Anda.');
                    saveStoryToHistory(userStory);
                } else {
                    showAlert('error', 'Analisis Gagal', 'AI tidak dapat memahami cerita Anda. Mohon berikan cerita yang lebih jelas dan deskriptif.');
                }
            } catch (error) {
                console.error('Error with AI feature:', error);
                showAlert('error', 'Terjadi Kesalahan', `Gagal terhubung dengan AI. Pastikan Kunci API Anda benar dan cek konsol (F12) untuk detail error.`);
            } finally {
                aiBtnText.innerHTML = `<i class="fas fa-lightbulb mr-3"></i>Sesuaikan dengan AI`;
                spinner.classList.add('hidden');
                aiBtn.disabled = false;
            }
        });
        
        generateBtn.addEventListener('click', () => {
            const fields = {
                gender: document.getElementById('gender').value, deskripsiKarakter: document.getElementById('deskripsiKarakter').value.trim(), deskripsiKostum: document.getElementById('deskripsiKostum').value.trim(), senjataAtauBenda: document.getElementById('senjataAtauBenda').value.trim(), deskripsiPose: document.getElementById('deskripsiPose').value.trim(), astralMagis: document.getElementById('astralMagis').value.trim(), lingkungan: document.getElementById('lingkungan').value.trim(), namaKarakter: document.getElementById('namaKarakter').value.trim().toUpperCase(), generateBy: document.getElementById('generateBy').value.trim(), bentukAlas: document.getElementById('bentukAlas').value, nuansa: document.getElementById('nuansaTemaAi').value // Use the correct select element
            };
            
            if (!fields.gender || !fields.deskripsiKarakter || !fields.deskripsiKostum || !fields.deskripsiPose || !fields.lingkungan || !fields.namaKarakter || !fields.generateBy) {
                showAlert("error", 'Formulir Belum Lengkap', 'Mohon isi semua kolom yang wajib diisi (kecuali Senjata & Hewan) sebelum menghasilkan prompt.');
                return;
            }

            // --- THEME LOGIC (RESTRUCTURED) ---
            const themeDetails = {
                KlasikStudio: {
                    baseStyle: "dari marmer poles yang bersih dan minimalis",
                    placement: "diletakkan di atas meja putih",
                    scene: "latar belakang kabur berupa ruangan nyaman dan terang, di mana sebuah Koleksi Aksi Figur dalam Etalase dan figur aksi lainnya terlihat diburamkan di latar belakang"
                },
                Cyberpunk: {
                    baseStyle: "dari panel logam dengan sirkuit terbuka dan kabel fiber optik yang menyala",
                    placement: "ditampilkan di sebuah gang kota cyberpunk yang ramai di malam hari, basah oleh hujan",
                    scene: "papan reklame neon yang menyala terang dan kendaraan terbang melintas di atas"
                },
                FantasiMistis: {
                    baseStyle: "dari batu kuno yang ditumbuhi lumut bercahaya dan diukir dengan rune sihir",
                    placement: "berada di tengah hutan fantasi yang berkilauan di malam hari",
                    scene: "partikel sihir mengambang di udara dan pohon-pohon raksasa menjulang ke langit berbintang"
                },
                PascaApokaliptik: {
                    baseStyle: "dari beton yang retak dan logam berkarat yang dilas menjadi satu",
                    placement: "berdiri di atas puing-puing",
                    scene: "pemandangan kota yang hancur saat matahari terbenam, gedung-gedung pencakar langit yang rusak, dan langit berwarna oranye karena debu"
                },
                Steampunk: {
                    baseStyle: "dari kayu mahoni yang diperkuat dengan lempengan kuningan dan roda gigi yang saling bertautan",
                    placement: "berada di dalam bengkel seorang insinyur steampunk",
                    scene: "dikelilingi oleh cetak biru, mesin yang rumit, dan jendela besar yang memperlihatkan kota industri Victoria"
                },
                Kosmik: {
                    baseStyle: "dari kristal obsidian yang permukaannya memantulkan gugusan bintang",
                    placement: "melayang di angkasa",
                    scene: "pemandangan luar angkasa yang menakjubkan, menampilkan galaksi spiral, gugusan bintang, dan aurora kosmik yang berwarna-warni"
                },
                HororGotik: {
                    baseStyle: "dari batu marmer hitam dengan ukiran gargoyle di sudut-sudutnya",
                    placement: "berdiri di interior kastil Drakula yang remang-remang",
                    scene: "jendela kaca patri tinggi, sarang laba-laba, dan bayangan memanjang yang menakutkan"
                },
                BioLuminescent: {
                    baseStyle: "dari jalinan akar kayu dan jamur yang memancarkan cahaya redup",
                    placement: "berada di dalam gua atau hutan alien di malam hari",
                    scene: "setiap tanaman, serangga, dan aliran air memancarkan cahaya biru, hijau, dan ungu yang lembut"
                },
                MesirKuno: {
                    baseStyle: "dari batu pasir yang diukir dengan hieroglif para dewa",
                    placement: "berada di interior makam firaun yang megah",
                    scene: "dinding yang dilukis, obor yang menyala, dan tumpukan harta karun emas"
                },
                KerajaanLangit: {
                    baseStyle: "dari awan padat yang dipahat dan dihiasi dengan kristal kuarsa",
                    placement: "berdiri di balkon sebuah istana di atas awan",
                    scene: "memandang ke lautan awan keemasan saat matahari terbit, dengan kota-kota melayang lainnya di kejauhan"
                },
                PasirPantaiTropis: {
                    baseStyle: "dari pasir putih halus dengan beberapa kerang dan bintang laut",
                    placement: "berdiri di tepi pantai tropis yang indah",
                    scene: "air laut biru jernih yang membasahi pasir, pohon-pohon palem melambai, dan matahari terbenam di cakrawala"
                },
                InteriorDojoJepang: {
                    baseStyle: "dari lantai kayu tatami dengan pintu geser shoji",
                    placement: "berada di tengah dojo tradisional Jepang yang tenang",
                    scene: "gulungan kaligrafi di dinding, rak senjata kayu, dan cahaya lembut masuk melalui jendela kertas"
                },
                LaboratoriumSciFi: {
                    baseStyle: "dari panel lantai heksagonal yang bersinar dengan cahaya biru",
                    placement: "berada di laboratorium fiksi ilmiah yang steril dan canggih",
                    scene: "dipenuhi dengan layar holografik, tabung stasis, dan lengan robotik"
                },
                DekKapalBajakLaut: {
                    baseStyle: "dari papan kayu lapuk dek kapal dengan tali-temali berserakan",
                    placement: "berdiri di dek kapal bajak laut yang sedang berlayar di laut lepas",
                    scene: "layar terkembang, meriam siap tembak, dan bendera Jolly Roger berkibar di tiang utama"
                },
                TamanBungaSakura: {
                    baseStyle: "dari batu loncatan yang dikelilingi kelopak bunga sakura merah muda",
                    placement: "berada di taman Jepang saat musim semi, di bawah pohon sakura yang sedang mekar penuh",
                    scene: "lentera batu dan jembatan kayu kecil di atas kolam koi"
                },
                ReruntuhanHutanKuno: {
                    baseStyle: "dari balok batu candi kuno yang ditumbuhi tanaman merambat",
                    placement: "berada di reruntuhan kota kuno yang tersembunyi jauh di dalam hutan lebat",
                    scene: "sinar matahari menembus kanopi dan kabut tipis menyelimuti tanah"
                },
                KotaBawahAir: {
                    baseStyle: "dari terumbu karang bercahaya dan reruntuhan Atlantis",
                    placement: "berada di kota bawah laut yang hilang",
                    scene: "bangunan kristal yang megah, ikan-ikan eksotis berenang di antara pilar-pilar kuno, dan cahaya biru dari permukaan laut di atas"
                },
                ArenaGladiator: {
                    baseStyle: "dari pasir dan batu arena Colosseum",
                    placement: "berdiri di tengah arena gladiator Romawi yang megah",
                    scene: "gerbang besi, dinding tribun yang menjulang tinggi dipenuhi penonton, dan bayangan dari arsitektur kuno"
                },
                IstanaEsArktik: {
                    baseStyle: "dari es transparan yang diukir dengan pola kepingan salju",
                    placement: "berada di interior istana es yang berkilauan di Kutub Utara",
                    scene: "pilar-pilar es raksasa, singgasana beku, dan aurora borealis menari di langit melalui atap kristal"
                },
                DuniaPermen: {
                    baseStyle: "dari biskuit wafer yang dilapisi gula warna-warni",
                    placement: "berada di lanskap permen yang fantastis",
                    scene: "sungai cokelat, pohon lolipop, bukit permen karet, dan rumah-rumah jahe di bawah langit pelangi"
                }
            };
            
            const selectedTheme = themeDetails[fields.nuansa] || themeDetails.KlasikStudio;
            const baseStyle = selectedTheme.baseStyle;
            const placement = selectedTheme.placement;
            const scene = selectedTheme.scene;

            const gayaVisual = document.getElementById('gayaVisual').value;
            let styleKeywords = gayaVisual === '4D Hyper Realism'
                ? '4D Stylized Hyper-Realism, Ultra-Detail, High-Realistic, UHD 8K, Highly Detailed, Hyper Cinematic Lighting, Sharp Depth of Field, High Saturation, Rich Color Palette, Sharp Contrast, Photographed with DSLR Mirrorless Camera, Realistic Proportional Anatomy, Full-body, Scale 1:16, Aspect Ratio 9:16, Long Legs, Balanced Body, HD Focused:'
                : '3D Chibi Stylized Action Figure, Disney Pixar Style, Cute, Adorable, Soft Round Shapes, Big Expressive Eyes, Vibrant Colors, Claymation look, High Detail, Studio Lighting, on a detailed miniature base:';
            
            let promptLines = [
                `Buat Gambar Visual Patung Fantasi dengan gaya ${styleKeywords}`,
                `\nKarakter: ${fields.gender} ${fields.deskripsiKarakter}`,
                `Kostum: ${fields.deskripsiKostum}`
            ];

            if (fields.senjataAtauBenda) {
                promptLines.push(`Benda: ${fields.senjataAtauBenda}`);
            }

            promptLines.push(`Pose dan Ekspresi: ${fields.deskripsiPose}`);

            if (fields.astralMagis) {
                promptLines.push(`Pendamping: ${fields.astralMagis}, pastikan makhluk ini berada sepenuhnya di dalam area alas monumental, meskipun melayang.`);
            }
            
            promptLines.push(`\nSemua elemen ini dipasang di atas alas base ${fields.bentukAlas} yang dirancang dari ${baseStyle}, di atasnya menampilkan miniatur detail dari ${fields.lingkungan}, dan dibuat tanpa efek kabut atau efek energi apapun yang membuat karakter tenggelam dan tidak ada elemen yang keluar dari area base.`);
            
            promptLines.push(`\nName Base: "${fields.namaKarakter}" ukuran: Large, Subtitle: “${fields.generateBy}” ukuran: Medium, terukir dalam tipografi bergaya iblis dan timbul.`);
            
            // UPDATED BACKGROUND DESCRIPTION LOGIC
            const backgroundDescription = `Figur ini ${placement}, dengan Latar Belakang ${scene}. Fokus utama hanya tertuju pada Patung Fantasi Realistis dan alasnya, dengan pencahayaan terang dan lembut. Gaya keseluruhan harus kuat.`;
            promptLines.push(`\n${backgroundDescription}`);
            
            outputPromptEl.value = promptLines.join('\n');
            resultSection.style.display = 'block';
            resultSection.scrollIntoView({ behavior: 'smooth' });
            showAlert('success', 'Prompt Dihasilkan', 'Prompt Anda sudah siap untuk disalin dan digunakan.');
        });

        resetBtn.addEventListener('click', () => {
            promptForm.reset();
            ceritaKarakterEl.value = '';
            document.getElementById('generateBy').value = 'PROMPT BY AIYRA DESIGN';
            document.getElementById('bentukAlas').value = 'Bulat';
            document.getElementById('gayaVisual').value = '4D Hyper Realism';
            document.getElementById('nuansaTemaAi').value = 'KlasikStudio'; // Reset theme
            outputPromptEl.value = '';
            resultSection.style.display = 'none';
            showAlert('success', 'Formulir Direset', 'Semua isian telah dikosongkan dan kembali ke pengaturan awal.');
        });

        copyBtn.addEventListener('click', () => {
            const textToCopy = outputPromptEl.value;
            if (!textToCopy) {
                showAlert('error', 'Tidak Ada Prompt', 'Tidak ada teks yang bisa disalin. Mohon hasilkan prompt terlebih dahulu.');
                return;
            }

            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = textToCopy;
            tempTextArea.style.position = 'absolute';
            tempTextArea.style.left = '-9999px';
            document.body.appendChild(tempTextArea);
            
            tempTextArea.select();
            tempTextArea.setSelectionRange(0, 99999); // For mobile devices

            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showAlert('success', 'Berhasil Disalin', 'Prompt telah berhasil disalin ke clipboard Anda.');
                    copyBtn.querySelector('#copy-text').textContent = 'Tersalin!';
                    setTimeout(() => { copyBtn.querySelector('#copy-text').textContent = 'Salin'; }, 2000);
                } else {
                    showAlert('error', 'Gagal Menyalin', 'Browser Anda mungkin tidak mendukung fitur ini. Mohon salin teks secara manual.');
                }
            } catch (err) {
                console.error('Gagal menyalin:', err);
                showAlert('error', 'Gagal Menyalin', 'Terjadi kesalahan teknis saat mencoba menyalin. Mohon salin teks secara manual.');
            }

            document.body.removeChild(tempTextArea);
        });

        // --- History Logic ---
        function getHistory() { return JSON.parse(localStorage.getItem('storyHistory')) || []; }
        function saveStoryToHistory(story) {
            let history = getHistory();
            if (!history.includes(story)) {
                history.unshift(story);
                history = history.slice(0, 20); 
                localStorage.setItem('storyHistory', JSON.stringify(history));
            }
        }
        function loadHistory() {
            const history = getHistory();
            historyList.innerHTML = '';
            if (history.length === 0) {
                historyList.innerHTML = '<p>Riwayat cerita Anda masih kosong.</p>';
                return;
            }
            history.forEach((story, index) => {
                const item = document.createElement('div');
                item.className = 'p-3 border border-slate-700 rounded-lg flex justify-between items-center';
                item.innerHTML = `<span class="story-text flex-grow-1 mr-3 cursor-pointer hover:text-violet-400">${story.substring(0, 50)}${story.length > 50 ? '...' : ''}</span>
                                  <button class="text-red-500 hover:text-red-400 delete-history-btn" data-index="${index}"><i class="fas fa-trash"></i></button>`;
                item.querySelector('.story-text').addEventListener('click', () => {
                    ceritaKarakterEl.value = story;
                    closeModal(historyModal);
                });
                historyList.appendChild(item);
            });
        }
        historyList.addEventListener('click', function(e) {
            const deleteBtn = e.target.closest('.delete-history-btn');
            if (deleteBtn) {
                const index = parseInt(deleteBtn.getAttribute('data-index'), 10);
                let history = getHistory();
                history.splice(index, 1);
                localStorage.setItem('storyHistory', JSON.stringify(history));
                loadHistory();
            }
        });
        clearHistoryBtn.addEventListener('click', () => {
            localStorage.removeItem('storyHistory');
            loadHistory();
            showAlert('success', 'Riwayat Dibersihkan', 'Semua riwayat cerita telah berhasil dihapus.');
        });

        // --- Theme Toggle Logic ---
        function applyTheme(theme) {
            body.classList.toggle('light-theme', theme === 'light');
            themeToggleBtn.innerHTML = theme === 'light' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
        }
        themeToggleBtn.addEventListener('click', () => {
            let currentTheme = localStorage.getItem('theme') || 'dark';
            let newTheme = currentTheme === 'light' ? 'dark' : 'light';
            localStorage.setItem('theme', newTheme);
            applyTheme(newTheme);
        });
        // --- Initial Load ---
        checkAccess();
        updateApiKeyStatus();
        const savedTheme = localStorage.getItem('theme') || 'dark';
        applyTheme(savedTheme);
    });
    </script>
</body>
</html>
